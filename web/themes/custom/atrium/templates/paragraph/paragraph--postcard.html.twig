{#
/**
 * @file
 * Template for "Postcard" Paragraph.
 *
 */
#}
{% extends 'paragraph.html.twig' %}
{% block paragraph %}

  {# Set defaults for Postcard component. #}
  {% set header_align_variant = 'has-header-left' %}
  {% set background_variant = paragraph.field_background.value %}
  {% set tag = paragraph.field_header.value %}
  {% set image = content.field_media|render ? content.field_media : '' %}

  {# @todo has-background-color is no longer the variant option. For now, we are
  mapping it to 'background-color--light--secondary`. Eventually this will need
  proper support. Will also advocate for the default to be set in PL, so we
  don't have to track/manually pass it. Current variant list as of 11/20/19:
  - has-background-color--transparent (default)
  - has-background-color--light--secondary (has-background-color)
  - has-background-color--dark--secondary (NOT SUPPORTED)
  - has-background-image (ok, handled below) #}
  {% if paragraph.field_background.value == 'default' %}
    {% set background_variant = 'has-background-color--transparent' %}
  {% elseif paragraph.field_background.value == 'has-background-color' %}
    {% set background_variant = 'has-background-color--light--secondary' %}
  {% endif %}

  {% if paragraph.field_postcard_display.value == 'has-background-image' %}
    {% if content.field_media|render %}
      {% set image_id = paragraph.field_media.entity.id() %}
      {% set image = drupal_entity('media', image_id, 'postcard_background') %}
    {% endif %}
  {% endif %}

  {% if paragraph.field_postcard_display.value == 'has-background-image' %}
    {% if content.field_media|render %}
      {% set image_id = paragraph.field_media.entity.id() %}
      {% set image = drupal_entity('media', image_id, 'postcard_background') %}
    {% endif %}
  {% endif %}

  {# @todo We may need to use the read-more.twig component here?  #}
  {% set body = '' %}
  {% if content.field_body|render or content.field_link|render %}
    {% set body %}
      {{ content.field_body }}
      {{ content.field_link }}
    {% endset %}
  {% endif %}

  {% include '@molecules/blocks/postcard/postcard.twig' with {
    id: paragraph_id,
    background_variant: background_variant,
    header_align_variant: header_align_variant,
    headergroup: {
      title: content.field_title_display|render ? content.field_title_display : '',
      body: body,
      tag: tag,
    },
    tag: content.field_text_overlay|render ? content.field_text_overlay : '',
    img: image,
  } only %}

  {% if content.field_additional|render %}
    {% include '@organisms/sections/text-section/text-section.twig' with {
      column_variant: 'two-columns-threequarter',
      headergroup: {
        lead: content.field_additional,
      },
    } only %}
  {% endif %}

  {{ content|without(
    'field_additional',
    'field_background',
    'field_body',
    'field_create_anchor',
    'field_header',
    'field_link',
    'field_media',
    'field_text_overlay',
    'field_title_display'
  ) }}

{% endblock %}
